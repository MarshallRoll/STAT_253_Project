---
title: "clustering"
author: "Marshall Roll"
date: "2022-11-15"
output: pdf_document
---

```{r}
# library statements 
library(ISLR)
library(dplyr)
library(readr)
library(broom)
library(ggplot2)
library(tidymodels) 
library(probably)
library(cluster)
tidymodels_prefer() # Resolves conflicts, prefers tidymodel functions
# read in data

stroke <- read_csv("https://raw.githubusercontent.com/MarshallRoll/STAT_253_Project/main/healthcare-dataset-stroke-data.csv?token=GHSAT0AAAAAAB2VESBM5CKF2AR2WIX2MS76Y3CZIYQ")
```

```{r}
stroke_scaled <- stroke %>% 
  mutate(across(where(is.numeric), scale))

stroke_scaled <- stroke_scaled %>% 
  mutate(across(where(is.character), as.factor))
```

```{r}
stroke_cluster <- hclust(dist(stroke_scaled) + (daisy(stroke_scaled %>% select(where(is.factor)), metric = "gower")), method = "complete")
plot(stroke_cluster)
```


```{r}
stroke_scaled <- stroke_scaled %>% 
  mutate(hclust_4 = factor(cutree(stroke_cluster, k = 4)), 
         hclust_3 = factor(cutree(stroke_cluster, k = 3)), 
         hclust_5 = factor(cutree(stroke_cluster, k = 5))) 

stroke_scaled %>% 
  ggplot(aes(x = as.numeric(bmi), y = as.numeric(avg_glucose_level),
             color = hclust_5)) +
geom_point() 

```

```{r}
wss <- function(d) {
  sum(scale(d, scale = FALSE)^2)
}

wrap <- function(i, hc, x) {
  cl <- cutree(hc, i)
  spl <- split(x, cl)
  wss <- sum(sapply(spl, wss))
  wss
}

wrap(3, stroke_cluster, )
```

